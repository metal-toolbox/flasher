{
  "transition_rules": [
    {
      "transition_type": "checkingInstalledFirmware",
      "source_states": [
        "poweredOnDevice"
      ],
      "destination_state": "checkedCurrentFirmware",
      "name": "Check installed firmware",
      "description": "Check firmware installed on component - if its equal - returns error, unless Task.Parameters.Force=true."
    },
    {
      "transition_type": "downloadingFirmware",
      "source_states": [
        "checkedCurrentFirmware"
      ],
      "destination_state": "downloadedFirmware",
      "name": "Download and verify firmware",
      "description": "Download and verify firmware file checksum."
    },
    {
      "transition_type": "failed",
      "source_states": [
        "queued",
        "active",
        "poweredOnDevice",
        "checkedCurrentFirmware",
        "downloadedFirmware",
        "initiatedInstallFirmware",
        "polledFirmwareInstallStatus",
        "resetBMC",
        "resetDevice",
        "poweredOffDevice"
      ],
      "destination_state": "failed",
      "name": "Failed",
      "description": "Firmware install on component failed."
    },
    {
      "transition_type": "initiatingInstallFirmware",
      "source_states": [
        "downloadedFirmware"
      ],
      "destination_state": "initiatedInstallFirmware",
      "name": "Initiate firmware install",
      "description": "Initiate firmware install for component."
    },
    {
      "transition_type": "pollingInstallStatus",
      "source_states": [
        "initiatedInstallFirmware"
      ],
      "destination_state": "polledFirmwareInstallStatus",
      "name": "Poll firmware install status",
      "description": "Poll BMC with exponential backoff for firmware install status until firmware install status is in a finalized state (completed/powercyclehost/powercyclebmc/failed)."
    },
    {
      "transition_type": "poweringOffDevice",
      "source_states": [
        "resetDevice",
        "skipped"
      ],
      "destination_state": "poweredOffDevice",
      "name": "Power off Device",
      "description": "Powercycle Device - only if this is the final firmware (action statemachine) to be installed and the device was powered off earlier."
    },
    {
      "transition_type": "poweringOnDevice",
      "source_states": [
        "queued"
      ],
      "destination_state": "poweredOnDevice",
      "name": "Power on device",
      "description": "Power on device - if its currently powered off."
    },
    {
      "transition_type": "resettingBMC",
      "source_states": [
        "polledFirmwareInstallStatus"
      ],
      "destination_state": "resetBMC",
      "name": "Powercycle BMC",
      "description": "Powercycle BMC - only when pollFirmwareInstallStatus() identifies a BMC reset is required."
    },
    {
      "transition_type": "resettingHost",
      "source_states": [
        "resetBMC"
      ],
      "destination_state": "resetDevice",
      "name": "Powercycle Device",
      "description": "Powercycle Device - only when pollFirmwareInstallStatus() identifies a Device power cycle is required."
    },
    {
      "transition_type": "success",
      "source_states": [
        "poweredOffDevice"
      ],
      "destination_state": "success",
      "name": "Success",
      "description": "Firmware install on component completed successfully."
    }
  ],
  "states": {
    "checkedCurrentFirmware": {
      "name": "checkedCurrentFirmware",
      "description": "This action state indicates the installed firmware on the component has been checked."
    },
    "downloadedFirmware": {
      "name": "downloadedFirmware",
      "description": "This action state indicates the component firmware to be installed has been downloaded and verified."
    },
    "initial": {
      "name": "Initial",
      "description": "The initial state of the state machine. This is a synthetic state that is not actually part of the state machine. It appears in documentation when transition rules hold a single source state that is an empty string"
    },
    "initiatedInstallFirmware": {
      "name": "initiatedInstallFirmware",
      "description": "This action state indicates the component firmware has been uploaded to the target device for install, and the firmware install on the device has been initiated."
    },
    "polledFirmwareInstallStatus": {
      "name": "polledFirmwareInstallStatus",
      "description": "This action state indicates the component firmware install status is in a finalized state (powerCycleDevice, powerCycleBMC, successful, failed)."
    },
    "poweredOffDevice": {
      "name": "poweredOffDevice",
      "description": "This action state indicates the Device has been (conditionally) power off to complete a component firmware install."
    },
    "poweredOnDevice": {
      "name": "poweredOnDevice",
      "description": "This action state indicates the device has been (conditionally) powered on for a component firmware install."
    },
    "resetBMC": {
      "name": "resetBMC",
      "description": "This action state indicates the BMC has been (conditionally) power cycled to complete a component firmware install."
    },
    "resetDevice": {
      "name": "resetDevice",
      "description": "This action state indicates the Device has been (conditionally) power cycled to complete a component firmware install."
    }
  },
  "transition_types": {
    "checkingInstalledFirmware": {
      "name": "checkingInstalledFirmware",
      "description": "In this action transition the installed component firmware is being checked."
    },
    "downloadingFirmware": {
      "name": "downloadingFirmware",
      "description": "In this action transition the component firmware to be installed is being downloaded and verified."
    },
    "initiatingInstallFirmware": {
      "name": "initiatingInstallFirmware",
      "description": "In this action transition the component firmware to be installed is being uploaded to the device and the component firmware install is being initated."
    },
    "pollingInstallStatus": {
      "name": "pollingInstallStatus",
      "description": "In this action transition the component firmware install status is being polled until its in a finalized state (powerCycleDevice, powerCycleBMC, successful, failed)."
    },
    "poweringOffDevice": {
      "name": "poweringOffDevice",
      "description": "In this action transition the Device will be powered-off if the device was powered off when task started."
    },
    "poweringOnDevice": {
      "name": "poweringOnDevice",
      "description": "In this action transition the device is being powered on for a component firmware install - if it was powered-off."
    },
    "resettingBMC": {
      "name": "resettingBMC",
      "description": "In this action transition the BMC is being power-cycled - if the component firmware install status requires a BMC reset to proceed/complete."
    },
    "resettingHost": {
      "name": "resettingHost",
      "description": "In this action transition the Device will be power-cycled if the component firmware install status requires a Device reset to proceed/complete."
    }
  }
}
